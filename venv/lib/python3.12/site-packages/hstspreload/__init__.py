"""Check if a host is in the Google Chrome HSTS Preload list"""

import functools
import os
import typing

__version__ = "2024.12.1"
__checksum__ = "e2f8c4f6cc16fdafbac2bdeb53469f807e59fef7da6fa5b544466bdbe5bd6677"
__all__ = ["in_hsts_preload"]

# fmt: off
_GTLD_INCLUDE_SUBDOMAINS = {b'amazon', b'android', b'app', b'audible', b'azure', b'bank', b'bing', b'boo', b'channel', b'chrome', b'dad', b'day', b'dev', b'eat', b'esq', b'fire', b'fly', b'foo', b'fujitsu', b'gle', b'gmail', b'google', b'hangout', b'hotmail', b'imdb', b'ing', b'insurance', b'kindle', b'meet', b'meme', b'microsoft', b'mov', b'new', b'nexus', b'office', b'page', b'phd', b'play', b'prime', b'prof', b'rsvp', b'search', b'silk', b'skype', b'windows', b'xbox', b'xn--cckwcxetd', b'xn--jlq480n2rg', b'youtube', b'zappos', b'zip'}  # noqa: E501
_JUMPTABLE = [[(0, 11), (11, 5), (16, 19), (35, 55), (90, 26), (116, 12), (128, 8), (136, 19), (155, 22), (177, 7), (184, 20), (204, 18), None, (222, 39), (261, 37), (298, 19), (317, 9), (326, 36), (362, 24), (386, 10), (396, 18), None, (414, 62), (476, 8), (484, 22), (506, 19), (525, 13), (538, 14), (552, 21), None, None, (573, 40), (613, 20), (633, 25), (658, 22), (680, 22), (702, 28), None, (730, 25), (755, 25), (780, 8), (788, 13), (801, 10), (811, 8), (819, 17), (836, 6), (842, 19), (861, 16), (877, 5), (882, 19), (901, 14), (915, 11), (926, 18), (944, 27), (971, 7), (978, 11), (989, 15), (1004, 12), (1016, 20), (1036, 8), (1044, 27), (1071, 46), (1117, 25), (1142, 16), (1158, 8), (1166, 5), (1171, 22), (1193, 18), None, (1211, 36), (1247, 15), (1262, 24), (1286, 11), None, (1297, 10), (1307, 23), (1330, 18), (1348, 18), (1366, 5), (1371, 20), (1391, 26), (1417, 27), (1444, 28), (1472, 20), (1492, 59), (1551, 21), (1572, 14), (1586, 8), (1594, 8), (1602, 10), (1612, 13), (1625, 20), (1645, 19), None, (1664, 13), (1677, 26), (1703, 11), (1714, 4), (1718, 22), (1740, 19), (1759, 21), (1780, 14), (1794, 28), (1822, 11), (1833, 10), (1843, 12), (1855, 25), None, (1880, 19), (1899, 14), (1913, 26), (1939, 45), (1984, 15), None, (1999, 11), (2010, 30), (2040, 21), (2061, 26), (2087, 6), (2093, 6), (2099, 14), (2113, 5), (2118, 30), (2148, 23), (2171, 6), (2177, 17), (2194, 8), (2202, 19), (2221, 12), (2233, 70), (2303, 55), (2358, 12), (2370, 23), (2393, 16), (2409, 29), (2438, 9), (2447, 24), (2471, 44), (2515, 6), (2521, 41), (2562, 22), (2584, 23), (2607, 31), (2638, 20), (2658, 8), (2666, 15), (2681, 12), (2693, 32), (2725, 25), (2750, 15), None, (2765, 46), (2811, 21), (2832, 17), (2849, 14), (2863, 26), (2889, 5), (2894, 37), (2931, 39), (2970, 16), (2986, 33), (3019, 17), (3036, 23), (3059, 21), (3080, 25), (3105, 19), (3124, 14), (3138, 7), (3145, 37), None, (3182, 18), (3200, 21), (3221, 27), (3248, 17), (3265, 24), (3289, 12), (3301, 36), (3337, 35), (3372, 12), (3384, 57), (3441, 25), (3466, 32), None, (3498, 8), (3506, 25), (3531, 18), (3549, 6), (3555, 23), None, (3578, 36), (3614, 33), (3647, 14), (3661, 16), (3677, 22), None, (3699, 30), (3729, 41), (3770, 50), (3820, 15), (3835, 20), (3855, 31), (3886, 21), (3907, 32), (3939, 24), (3963, 20), (3983, 17), (4000, 60), (4060, 6), (4066, 9), (4075, 12), (4087, 18), (4105, 11), (4116, 10), (4126, 39), (4165, 42), None, (4207, 36), (4243, 17), None, (4260, 8), (4268, 8), (4276, 17), None, (4293, 25), (4318, 17), None, (4335, 21), (4356, 35), (4391, 21), (4412, 10), (4422, 48), (4470, 11), (4481, 37), (4518, 41), (4559, 23), (4582, 12), (4594, 14), (4608, 23), (4631, 29), (4660, 14), (4674, 8), (4682, 47), (4729, 52), None, None, (4781, 47), (4828, 42), None, (4870, 18), None, (4888, 20), (4908, 8), (4916, 21), (4937, 6), (4943, 29), (4972, 22)], [(4994, 9577), (14571, 9062), (23633, 9808), (33441, 9464), (42905, 8995), (51900, 9396), (61296, 9877), (71173, 9009), (80182, 9064), (89246, 8973), (98219, 9449), (107668, 8833), (116501, 9305), (125806, 10272), (136078, 9198), (145276, 10055), (155331, 9928), (165259, 8832), (174091, 9599), (183690, 8800), (192490, 9873), (202363, 9109), (211472, 9625), (221097, 9634), (230731, 9840), (240571, 9135), (249706, 9824), (259530, 10373), (269903, 9214), (279117, 8953), (288070, 9872), (297942, 9474), (307416, 9340), (316756, 9660), (326416, 9175), (335591, 9767), (345358, 9515), (354873, 10563), (365436, 9958), (375394, 9793), (385187, 10162), (395349, 8381), (403730, 9470), (413200, 9240), (422440, 8976), (431416, 9530), (440946, 8904), (449850, 10613), (460463, 9115), (469578, 8738), (478316, 9555), (487871, 9035), (496906, 9375), (506281, 9333), (515614, 8985), (524599, 9284), (533883, 9281), (543164, 9501), (552665, 9575), (562240, 8345), (570585, 8785), (579370, 9736), (589106, 9612), (598718, 9914), (608632, 10382), (619014, 8935), (627949, 9415), (637364, 9973), (647337, 10238), (657575, 9247), (666822, 8845), (675667, 9135), (684802, 8534), (693336, 10159), (703495, 9227), (712722, 9777), (722499, 8817), (731316, 10623), (741939, 9545), (751484, 8946), (760430, 9539), (769969, 8794), (778763, 8972), (787735, 9421), (797156, 9517), (806673, 9693), (816366, 10216), (826582, 9197), (835779, 8774), (844553, 9399), (853952, 10582), (864534, 9306), (873840, 8758), (882598, 9168), (891766, 9389), (901155, 9230), (910385, 9379), (919764, 8665), (928429, 9381), (937810, 8658), (946468, 9161), (955629, 8963), (964592, 9330), (973922, 8960), (982882, 9175), (992057, 10146), (1002203, 9552), (1011755, 10008), (1021763, 9105), (1030868, 9047), (1039915, 9892), (1049807, 9673), (1059480, 8496), (1067976, 8785), (1076761, 9390), (1086151, 9150), (1095301, 9703), (1105004, 9750), (1114754, 9375), (1124129, 9212), (1133341, 9515), (1142856, 9244), (1152100, 9189), (1161289, 9351), (1170640, 9623), (1180263, 9120), (1189383, 9484), (1198867, 10161), (1209028, 9102), (1218130, 10694), (1228824, 10359), (1239183, 9364), (1248547, 8822), (1257369, 8586), (1265955, 8861), (1274816, 10181), (1284997, 10155), (1295152, 10483), (1305635, 9504), (1315139, 10096), (1325235, 10331), (1335566, 9822), (1345388, 9366), (1354754, 9478), (1364232, 10575), (1374807, 8140), (1382947, 9641), (1392588, 9396), (1401984, 9237), (1411221, 9371), (1420592, 9147), (1429739, 9246), (1438985, 9145), (1448130, 8771), (1456901, 9025), (1465926, 9526), (1475452, 9709), (1485161, 9658), (1494819, 9009), (1503828, 8800), (1512628, 8899), (1521527, 9351), (1530878, 9509), (1540387, 9049), (1549436, 9461), (1558897, 10479), (1569376, 10295), (1579671, 8695), (1588366, 10731), (1599097, 9366), (1608463, 9298), (1617761, 9232), (1626993, 9872), (1636865, 9154), (1646019, 9137), (1655156, 9562), (1664718, 10106), (1674824, 9671), (1684495, 9192), (1693687, 8766), (1702453, 11721), (1714174, 10098), (1724272, 8875), (1733147, 9124), (1742271, 9591), (1751862, 9839), (1761701, 8899), (1770600, 10254), (1780854, 9299), (1790153, 9590), (1799743, 9493), (1809236, 9229), (1818465, 9291), (1827756, 8527), (1836283, 9211), (1845494, 8777), (1854271, 8643), (1862914, 8929), (1871843, 9409), (1881252, 9766), (1891018, 9447), (1900465, 9731), (1910196, 9618), (1919814, 8367), (1928181, 9683), (1937864, 9917), (1947781, 8832), (1956613, 9512), (1966125, 10587), (1976712, 8939), (1985651, 10155), (1995806, 9558), (2005364, 9078), (2014442, 9104), (2023546, 9648), (2033194, 9427), (2042621, 9002), (2051623, 9354), (2060977, 9189), (2070166, 10067), (2080233, 9099), (2089332, 8869), (2098201, 9681), (2107882, 9347), (2117229, 9663), (2126892, 9080), (2135972, 10068), (2146040, 9741), (2155781, 9569), (2165350, 10065), (2175415, 10027), (2185442, 9346), (2194788, 9037), (2203825, 10063), (2213888, 8886), (2222774, 10337), (2233111, 9079), (2242190, 8668), (2250858, 8674), (2259532, 9894), (2269426, 9877), (2279303, 9574), (2288877, 9671), (2298548, 9843), (2308391, 9040), (2317431, 10514), (2327945, 9992), (2337937, 9197), (2347134, 9618), (2356752, 8760), (2365512, 9279), (2374791, 9365), (2384156, 9076), (2393232, 8978), (2402210, 9344), (2411554, 9598)], [(2421152, 963), (2422115, 854), (2422969, 928), (2423897, 857), (2424754, 941), (2425695, 840), (2426535, 683), (2427218, 969), (2428187, 685), (2428872, 957), (2429829, 529), (2430358, 755), (2431113, 981), (2432094, 1082), (2433176, 833), (2434009, 773), (2434782, 1306), (2436088, 829), (2436917, 814), (2437731, 848), (2438579, 1198), (2439777, 791), (2440568, 797), (2441365, 740), (2442105, 809), (2442914, 836), (2443750, 953), (2444703, 1371), (2446074, 868), (2446942, 790), (2447732, 878), (2448610, 784), (2449394, 754), (2450148, 831), (2450979, 1078), (2452057, 1122), (2453179, 622), (2453801, 934), (2454735, 779), (2455514, 1035), (2456549, 872), (2457421, 804), (2458225, 745), (2458970, 880), (2459850, 852), (2460702, 874), (2461576, 807), (2462383, 868), (2463251, 841), (2464092, 618), (2464710, 780), (2465490, 801), (2466291, 861), (2467152, 980), (2468132, 1474), (2469606, 692), (2470298, 913), (2471211, 770), (2471981, 691), (2472672, 810), (2473482, 896), (2474378, 888), (2475266, 1077), (2476343, 932), (2477275, 877), (2478152, 844), (2478996, 1034), (2480030, 727), (2480757, 591), (2481348, 1082), (2482430, 888), (2483318, 757), (2484075, 450), (2484525, 843), (2485368, 454), (2485822, 827), (2486649, 656), (2487305, 1003), (2488308, 944), (2489252, 654), (2489906, 910), (2490816, 831), (2491647, 956), (2492603, 802), (2493405, 1029), (2494434, 968), (2495402, 772), (2496174, 608), (2496782, 934), (2497716, 960), (2498676, 1152), (2499828, 1204), (2501032, 1011), (2502043, 809), (2502852, 728), (2503580, 638), (2504218, 1015), (2505233, 863), (2506096, 774), (2506870, 786), (2507656, 863), (2508519, 817), (2509336, 833), (2510169, 624), (2510793, 830), (2511623, 976), (2512599, 757), (2513356, 622), (2513978, 882), (2514860, 1067), (2515927, 896), (2516823, 1058), (2517881, 1124), (2519005, 860), (2519865, 739), (2520604, 782), (2521386, 808), (2522194, 905), (2523099, 676), (2523775, 771), (2524546, 1106), (2525652, 782), (2526434, 950), (2527384, 865), (2528249, 956), (2529205, 894), (2530099, 876), (2530975, 939), (2531914, 654), (2532568, 995), (2533563, 799), (2534362, 1037), (2535399, 758), (2536157, 683), (2536840, 684), (2537524, 998), (2538522, 990), (2539512, 724), (2540236, 671), (2540907, 941), (2541848, 863), (2542711, 716), (2543427, 773), (2544200, 697), (2544897, 838), (2545735, 708), (2546443, 878), (2547321, 669), (2547990, 895), (2548885, 745), (2549630, 883), (2550513, 728), (2551241, 825), (2552066, 947), (2553013, 1095), (2554108, 925), (2555033, 837), (2555870, 1106), (2556976, 934), (2557910, 785), (2558695, 1098), (2559793, 742), (2560535, 1001), (2561536, 982), (2562518, 1156), (2563674, 1189), (2564863, 686), (2565549, 970), (2566519, 746), (2567265, 749), (2568014, 884), (2568898, 540), (2569438, 1225), (2570663, 695), (2571358, 1035), (2572393, 868), (2573261, 1050), (2574311, 871), (2575182, 685), (2575867, 790), (2576657, 2052), (2578709, 873), (2579582, 940), (2580522, 842), (2581364, 1093), (2582457, 652), (2583109, 966), (2584075, 953), (2585028, 648), (2585676, 1060), (2586736, 644), (2587380, 630), (2588010, 562), (2588572, 1264), (2589836, 835), (2590671, 794), (2591465, 788), (2592253, 730), (2592983, 1019), (2594002, 981), (2594983, 944), (2595927, 889), (2596816, 973), (2597789, 785), (2598574, 781), (2599355, 767), (2600122, 805), (2600927, 1051), (2601978, 1008), (2602986, 824), (2603810, 856), (2604666, 756), (2605422, 925), (2606347, 1150), (2607497, 573), (2608070, 830), (2608900, 798), (2609698, 863), (2610561, 742), (2611303, 646), (2611949, 675), (2612624, 945), (2613569, 938), (2614507, 1073), (2615580, 580), (2616160, 749), (2616909, 769), (2617678, 878), (2618556, 856), (2619412, 833), (2620245, 1061), (2621306, 606), (2621912, 1095), (2623007, 760), (2623767, 748), (2624515, 824), (2625339, 922), (2626261, 720), (2626981, 974), (2627955, 970), (2628925, 884), (2629809, 550), (2630359, 936), (2631295, 717), (2632012, 993), (2633005, 576), (2633581, 806), (2634387, 926), (2635313, 752), (2636065, 978), (2637043, 2389), (2639432, 763), (2640195, 997), (2641192, 816), (2642008, 928), (2642936, 831)], [(2643767, 48), None, None, (2643815, 42), None, (2643857, 27), (2643884, 43), None, None, None, None, None, None, None, (2643927, 21), None, None, (2643948, 42), (2643990, 20), (2644010, 25), (2644035, 44), None, (2644079, 64), (2644143, 18), None, (2644161, 23), None, None, None, None, None, None, (2644184, 21), (2644205, 46), None, None, (2644251, 44), None, None, None, None, (2644295, 44), (2644339, 42), (2644381, 23), None, None, None, None, (2644404, 42), None, None, None, None, None, (2644446, 31), None, None, None, None, (2644477, 42), (2644519, 19), None, None, (2644538, 21), None, (2644559, 26), (2644585, 56), None, (2644641, 16), (2644657, 42), (2644699, 27), None, None, None, None, (2644726, 21), (2644747, 52), None, (2644799, 17), (2644816, 20), (2644836, 42), None, None, None, (2644878, 40), (2644918, 17), (2644935, 27), (2644962, 21), None, None, None, (2644983, 24), None, (2645007, 24), (2645031, 21), (2645052, 24), None, (2645076, 48), None, None, (2645124, 17), (2645141, 19), None, None, None, None, (2645160, 31), None, None, None, None, None, None, (2645191, 28), None, (2645219, 42), (2645261, 42), (2645303, 17), (2645320, 17), (2645337, 26), (2645363, 17), (2645380, 19), None, (2645399, 25), (2645424, 17), None, (2645441, 20), None, None, (2645461, 42), (2645503, 63), (2645566, 17), None, None, (2645583, 21), None, None, None, None, (2645604, 21), (2645625, 16), None, (2645641, 31), None, None, None, None, (2645672, 42), None, (2645714, 80), None, (2645794, 9), None, (2645803, 21), (2645824, 42), None, (2645866, 18), (2645884, 90), (2645974, 56), (2646030, 45), None, (2646075, 61), None, None, (2646136, 24), (2646160, 21), None, None, None, None, None, (2646181, 42), (2646223, 21), (2646244, 21), None, (2646265, 42), (2646307, 25), None, (2646332, 55), (2646387, 21), (2646408, 42), None, None, (2646450, 36), (2646486, 16), None, None, (2646502, 16), None, (2646518, 35), None, None, (2646553, 21), None, (2646574, 22), (2646596, 21), (2646617, 21), (2646638, 21), None, (2646659, 63), (2646722, 41), (2646763, 39), (2646802, 42), None, None, None, None, None, (2646844, 15), (2646859, 21), (2646880, 21), None, None, (2646901, 21), None, (2646922, 23), (2646945, 21), None, None, (2646966, 19), (2646985, 66), None, None, None, (2647051, 50), None, (2647101, 21), (2647122, 21), (2647143, 19), None, (2647162, 16), (2647178, 26), None, (2647204, 58), (2647262, 42), None, None, None, None, None, None, (2647304, 21), None, None, None, (2647325, 21), None, None, (2647346, 64), None, (2647410, 254), (2647664, 21), (2647685, 24), None, (2647709, 21), (2647730, 29)], [None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, (2647759, 62), None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None]]  # noqa: E501
_CRC8_TABLE = [
    0x00, 0x07, 0x0e, 0x09, 0x1c, 0x1b, 0x12, 0x15,
    0x38, 0x3f, 0x36, 0x31, 0x24, 0x23, 0x2a, 0x2d,
    0x70, 0x77, 0x7e, 0x79, 0x6c, 0x6b, 0x62, 0x65,
    0x48, 0x4f, 0x46, 0x41, 0x54, 0x53, 0x5a, 0x5d,
    0xe0, 0xe7, 0xee, 0xe9, 0xfc, 0xfb, 0xf2, 0xf5,
    0xd8, 0xdf, 0xd6, 0xd1, 0xc4, 0xc3, 0xca, 0xcd,
    0x90, 0x97, 0x9e, 0x99, 0x8c, 0x8b, 0x82, 0x85,
    0xa8, 0xaf, 0xa6, 0xa1, 0xb4, 0xb3, 0xba, 0xbd,
    0xc7, 0xc0, 0xc9, 0xce, 0xdb, 0xdc, 0xd5, 0xd2,
    0xff, 0xf8, 0xf1, 0xf6, 0xe3, 0xe4, 0xed, 0xea,
    0xb7, 0xb0, 0xb9, 0xbe, 0xab, 0xac, 0xa5, 0xa2,
    0x8f, 0x88, 0x81, 0x86, 0x93, 0x94, 0x9d, 0x9a,
    0x27, 0x20, 0x29, 0x2e, 0x3b, 0x3c, 0x35, 0x32,
    0x1f, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0d, 0x0a,
    0x57, 0x50, 0x59, 0x5e, 0x4b, 0x4c, 0x45, 0x42,
    0x6f, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7d, 0x7a,
    0x89, 0x8e, 0x87, 0x80, 0x95, 0x92, 0x9b, 0x9c,
    0xb1, 0xb6, 0xbf, 0xb8, 0xad, 0xaa, 0xa3, 0xa4,
    0xf9, 0xfe, 0xf7, 0xf0, 0xe5, 0xe2, 0xeb, 0xec,
    0xc1, 0xc6, 0xcf, 0xc8, 0xdd, 0xda, 0xd3, 0xd4,
    0x69, 0x6e, 0x67, 0x60, 0x75, 0x72, 0x7b, 0x7c,
    0x51, 0x56, 0x5f, 0x58, 0x4d, 0x4a, 0x43, 0x44,
    0x19, 0x1e, 0x17, 0x10, 0x05, 0x02, 0x0b, 0x0c,
    0x21, 0x26, 0x2f, 0x28, 0x3d, 0x3a, 0x33, 0x34,
    0x4e, 0x49, 0x40, 0x47, 0x52, 0x55, 0x5c, 0x5b,
    0x76, 0x71, 0x78, 0x7f, 0x6a, 0x6d, 0x64, 0x63,
    0x3e, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2c, 0x2b,
    0x06, 0x01, 0x08, 0x0f, 0x1a, 0x1d, 0x14, 0x13,
    0xae, 0xa9, 0xa0, 0xa7, 0xb2, 0xb5, 0xbc, 0xbb,
    0x96, 0x91, 0x98, 0x9f, 0x8a, 0x8d, 0x84, 0x83,
    0xde, 0xd9, 0xd0, 0xd7, 0xc2, 0xc5, 0xcc, 0xcb,
    0xe6, 0xe1, 0xe8, 0xef, 0xfa, 0xfd, 0xf4, 0xf3
]
# fmt: on

_IS_LEAF = 0x80
_INCLUDE_SUBDOMAINS = 0x40


try:
    from importlib.resources import open_binary

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open_binary("hstspreload", path)


except ImportError:

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open(
            os.path.join(os.path.dirname(os.path.abspath(__file__)), path),
            "rb",
        )


@functools.lru_cache(maxsize=1024)
def in_hsts_preload(host: typing.AnyStr) -> bool:
    """Determines if an IDNA-encoded host is on the HSTS preload list"""

    if isinstance(host, str):
        host = host.encode("ascii")
    labels = host.lower().split(b".")

    # Fast-branch for gTLDs that are registered to preload all sub-domains.
    if labels[-1] in _GTLD_INCLUDE_SUBDOMAINS:
        return True

    with open_pkg_binary("hstspreload.bin") as f:
        for layer, label in enumerate(labels[::-1]):
            # None of our layers are greater than 5 deep.
            if layer > 4:
                return False

            # Read the jump table for the layer and label
            jump_info = _JUMPTABLE[layer][_crc8(label)]
            if jump_info is None:
                # No entry: host is not preloaded
                return False

            # Read the set of entries for that layer and label
            f.seek(jump_info[0])
            data = bytearray(jump_info[1])
            f.readinto(data)

            for is_leaf, include_subdomains, ent_label in _iter_entries(data):
                # We found a potential leaf
                if is_leaf:
                    if ent_label == host:
                        return True
                    if include_subdomains and host.endswith(b"." + ent_label):
                        return True

                # Continue traversing as we're not at a leaf.
                elif label == ent_label:
                    break
            else:
                return False
    return False


def _iter_entries(data: bytes) -> typing.Iterable[typing.Tuple[int, int, bytes]]:
    while data:
        flags = data[0]
        size = data[1]
        label = bytes(data[2 : 2 + size])
        yield (flags & _IS_LEAF, flags & _INCLUDE_SUBDOMAINS, label)
        data = data[2 + size :]


def _crc8(value: bytes) -> int:
    # CRC8 reference implementation: https://github.com/niccokunzmann/crc8
    checksum = 0x00
    for byte in value:
        checksum = _CRC8_TABLE[checksum ^ byte]
    return checksum
